<!DOCTYPE html>
<html lang="es-MX" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Sistema de inventario profesional para promotores de PepsiCo">
  <meta name="author" content="JosÃ© A. G. Betancourt">
  <meta name="theme-color" content="#004aad">
  <title>ğŸ¦… Ãguila Inventario Pro</title>

  <link rel="manifest" href="manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Ãguila Pro">
  <link rel="apple-touch-icon" href="icon-192x192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512x512.png">

  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="custom-styles.css">
</head>

<body>
  <div class="toast-container" role="alert" aria-live="polite" aria-atomic="true"></div>

  <!-- ============================================================
       ESCÃNER MODAL
       ============================================================ -->
  <div id="scanner-modal" class="scanner-modal hidden">
    <div class="scanner-container">
      <div style="position:absolute;top:0;width:100%;text-align:center;padding:15px;background:var(--primary);">
        <h3 style="color:white;margin:0;font-size:1.1em;">ğŸ“· EscÃ¡ner de CÃ³digo de Barras</h3>
      </div>
      <div class="scanner-video-wrapper">
        <video id="scanner-video" autoplay playsinline></video>
        <div class="scanner-overlay">
          <div class="scanner-frame"></div>
          <div class="scanner-instruction">Apunta la cÃ¡mara al cÃ³digo de barras</div>
        </div>
      </div>
      <button id="close-scanner" class="scanner-close-btn">Cerrar EscÃ¡ner</button>
    </div>
  </div>

  <!-- ============================================================
       MODAL CREAR PRODUCTO NUEVO
       ============================================================ -->
  <div id="create-product-modal" class="modal-overlay hidden" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
    <div class="modal-content card" style="max-width: 500px; padding: 24px; position: relative;">
      <button style="position: absolute; top: 12px; right: 12px; background: none; border: none; font-size: 24px; cursor: pointer;" onclick="cerrarModalCrearProducto()">âœ•</button>
      
      <h3 style="color: #004aad; margin-bottom: 20px;">ğŸ“ Crear Nuevo Producto</h3>
      
      <div class="form-group">
        <label for="create-product-barcode">CÃ³digo de Barras</label>
        <input id="create-product-barcode" type="text" readonly style="background: #f0f9ff;" />
      </div>
      
      <div class="form-group">
        <label for="create-product-name">Nombre del Producto *</label>
        <input id="create-product-name" type="text" placeholder="Ej: Pepsi 1L" required />
      </div>
      
      <div class="form-group">
        <label for="create-product-marca">Marca</label>
        <select id="create-product-marca">
          <option value="Otra">Otra</option>
          <option value="Sabritas">Sabritas</option>
          <option value="Gamesa">Gamesa</option>
          <option value="Quaker">Quaker</option>
          <option value="Sonric's">Sonric's</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="create-product-piezas">Piezas por Caja</label>
        <input id="create-product-piezas" type="number" value="24" min="1" />
      </div>
      
      <div class="form-group">
        <label for="create-product-warehouse">Bodega/UbicaciÃ³n *</label>
        <input id="create-product-warehouse" type="text" placeholder="Ej: AlmacÃ©n 1" required />
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px;">
        <button type="button" id="save-product-modal-btn" class="primary">ğŸ’¾ Crear Producto</button>
        <button type="button" id="close-product-modal-btn" class="secondary" style="background: #e5e7eb; color: #1f2937;">âŒ Cancelar</button>
      </div>
    </div>
  </div>

  <main id="main-app">
    
    <!-- ============================================================
         PANTALLA AUTH
         ============================================================ -->
    <section id="auth-setup" class="card" style="max-width:500px;margin:50px auto;">
      <h2 style="text-align:center;color:var(--primary);margin-bottom:24px;">ğŸ¦… Ãguila Inventario Pro</h2>

      <!-- LOGIN FORM -->
      <form id="login-form">
        <div class="form-group">
          <label for="login-email">Email</label>
          <input id="login-email" type="email" placeholder="tu.email@empresa.com" required />
        </div>
        <div class="form-group">
          <label for="login-password">ContraseÃ±a</label>
          <input id="login-password" type="password" placeholder="MÃ­nimo 6 caracteres" required />
        </div>
        <button type="button" id="btn-login" class="success" style="width:100%;">Iniciar SesiÃ³n</button>
        <p style="text-align:center;margin-top:15px;">
          <a href="#" id="show-forgot-password" style="color:var(--warning);">Â¿Olvidaste tu contraseÃ±a?</a>
        </p>
        <p style="text-align:center;">
          <a href="#" id="show-register" style="color:var(--primary);">Â¿Eres nuevo? RegÃ­strate aquÃ­</a>
        </p>
      </form>

      <!-- FORGOT PASSWORD FORM -->
      <form id="forgot-password-form" class="hidden">
        <h3 style="text-align:center;color:var(--primary);">Recuperar ContraseÃ±a</h3>
        <div class="form-group">
          <label for="forgot-email">Email</label>
          <input id="forgot-email" type="email" placeholder="tu.email@empresa.com" required />
        </div>
        <button type="submit" class="warning" style="width:100%;">Enviar Enlace</button>
        <p style="text-align:center;margin-top:15px;">
          <a href="#" id="show-login-from-forgot" style="color:var(--primary);">Volver al inicio de sesiÃ³n</a>
        </p>
      </form>

      <!-- REGISTER FORM -->
      <form id="register-form" class="hidden">
        <h3 style="text-align:center;color:var(--primary);">Registro Inicial</h3>
        <div class="form-group">
          <label for="register-email">Email</label>
          <input id="register-email" type="email" placeholder="tu.email@empresa.com" required />
        </div>
        <div class="form-group">
          <label for="register-password">ContraseÃ±a</label>
          <input id="register-password" type="password" placeholder="MÃ­nimo 6 caracteres" minlength="6" required />
        </div>
        <div class="form-group">
          <label for="register-determinante">Determinante (Tienda)</label>
          <input id="register-determinante" type="number" placeholder="Ej: 12345" required />
        </div>
        <div class="form-group">
          <label for="register-store-name">Nombre de la Tienda</label>
          <input id="register-store-name" type="text" placeholder="Ej: Oxxo Centro" required />
        </div>
        <div class="form-group">
          <label for="register-promoter-name">Nombre del Promotor</label>
          <input id="register-promoter-name" type="text" placeholder="Ej: Juan PÃ©rez" required />
        </div>
        <button type="submit" class="success" style="width:100%;">Registrar y Entrar</button>
        <p style="text-align:center;margin-top:15px;">
          <a href="#" id="show-login" style="color:var(--primary);">Ya tengo cuenta</a>
        </p>
      </form>
    </section>

    <!-- ============================================================
         APLICACIÃ“N PRINCIPAL
         ============================================================ -->
    <section id="app-container" style="display:none;">
      
      <!-- HEADER APP -->
      <div class="app-header">
        <div style="display:flex;align-items:center;gap:12px;">
          <div class="app-title">ğŸ¦… Ãguila Inventario Pro</div>
        </div>
        <div style="display:flex;align-items:center;gap:12px;">
          <button class="btn-icon" id="btn-offline-status">ğŸ“¡</button>
          <button class="btn-icon" id="btn-logout">ğŸšª</button>
        </div>
      </div>

      <!-- BOTTOM NAVIGATION -->
      <nav class="bottom-nav">
        <a href="#" class="nav-btn active" data-tab="inventory">
          <span style="font-size:20px;">ğŸ“¦</span>
          <span>Inventario</span>
        </a>
        <a href="#" class="nav-btn" data-tab="add">
          <span style="font-size:20px;">â•</span>
          <span>Agregar</span>
        </a>
        <a href="#" class="nav-btn" data-tab="refill">
          <span style="font-size:20px;">ğŸ”„</span>
          <span>Relleno</span>
        </a>
        <a href="#" class="nav-btn" data-tab="audit">
          <span style="font-size:20px;">âœ“</span>
          <span>AuditorÃ­a</span>
        </a>
        <a href="#" class="nav-btn" data-tab="analytics">
          <span style="font-size:20px;">ğŸ“Š</span>
          <span>Analytics</span>
        </a>
        <a href="#" class="nav-btn" data-tab="system">
          <span style="font-size:20px;">âš™ï¸</span>
          <span>Sistema</span>
        </a>
      </nav>

      <!-- CONTENIDO PRINCIPAL -->
      <div class="main-content">
        
        <!-- TAB: INVENTARIO -->
        <div id="tab-inventory" class="tab-content active">
          <div class="card">
            <h2>ğŸ“¦ Inventario por Marca</h2>
            <div id="inventory-list" style="margin-top:20px;">
              <p style="color:var(--muted);">Cargando inventario...</p>
            </div>
          </div>
        </div>

        <!-- TAB: AGREGAR PRODUCTO -->
        <div id="tab-add" class="tab-content hidden">
          <div class="card">
            <h2>â• Agregar Producto</h2>
            <form id="add-product-form" style="margin-top:20px;">
              <div class="form-group">
                <label for="add-barcode">CÃ³digo de Barras</label>
                <div style="display:flex;gap:8px;">
                  <input id="add-barcode" type="text" placeholder="Escanea o ingresa el cÃ³digo" />
                  <button type="button" id="btn-scan-add" class="success" style="width:auto;padding:12px 16px;">ğŸ“·</button>
                </div>
              </div>

              <div class="form-group">
                <label for="add-product-name">Nombre del Producto</label>
                <input id="add-product-name" type="text" placeholder="Ej: Pepsi 1L" required />
              </div>

              <div class="form-group">
                <label for="add-brand">Marca</label>
                <select id="add-brand" required>
                  <option value="">-- Selecciona una marca --</option>
                  <option value="Sabritas">Sabritas</option>
                  <option value="Gamesa">Gamesa</option>
                  <option value="Quaker">Quaker</option>
                  <option value="Sonric's">Sonric's</option>
                  <option value="Otra">Otra</option>
                </select>
              </div>

              <div class="form-group">
                <label for="add-pieces-per-box">Piezas por Caja</label>
                <input id="add-pieces-per-box" type="number" placeholder="Ej: 24" min="1" required />
              </div>

              <div class="form-group">
                <label for="add-warehouse">UbicaciÃ³n/AlmacÃ©n</label>
                <input id="add-warehouse" type="text" placeholder="Ej: AlmacÃ©n 1" required />
              </div>

              <div class="form-group">
                <label for="add-expiry-date">Fecha de Caducidad</label>
                <input id="add-expiry-date" type="date" required />
              </div>

              <div class="form-group">
                <label for="add-boxes">Cantidad de Cajas</label>
                <input id="add-boxes" type="number" placeholder="Ej: 10" min="0" required />
              </div>

              <button type="submit" class="primary" style="width:100%;">âœ… Guardar Producto</button>
            </form>
          </div>
        </div>

        <!-- TAB: RELLENO -->
        <div id="tab-refill" class="tab-content hidden">
          <div class="card">
            <h2>ğŸ”„ Reabastecimiento Inteligente</h2>
            <p style="color: #6b7280; font-size: 13px;">Escanea productos existentes o crea nuevos sobre la marcha</p>
            
            <form id="refill-form" style="margin-top: 20px;">
              <div class="form-group">
                <label for="refill-barcode">CÃ³digo de Barras</label>
                <div style="display:flex;gap:8px;">
                  <input id="refill-barcode" type="text" placeholder="Escanea o escribe el cÃ³digo" />
                  <button type="button" id="btn-scan-refill" class="success" style="width:auto;padding:12px 16px;">ğŸ“·</button>
                </div>
              </div>

              <div class="form-group">
                <label for="refill-nombre">Nombre del Producto</label>
                <input id="refill-nombre" type="text" placeholder="Se llenarÃ¡ automÃ¡ticamente" readonly style="background: #f8fafc;" />
              </div>

              <div class="form-group">
                <label for="refill-marca">Marca</label>
                <input id="refill-marca" type="text" placeholder="Se llenarÃ¡ automÃ¡ticamente" readonly style="background: #f8fafc;" />
              </div>

              <div class="form-group">
                <label for="refill-piezas">Piezas por Caja</label>
                <input id="refill-piezas" type="number" placeholder="Se llenarÃ¡ automÃ¡ticamente" readonly style="background: #f8fafc;" />
              </div>

              <div class="form-group">
                <label for="refill-warehouse">Bodega/UbicaciÃ³n</label>
                <input id="refill-warehouse" type="text" placeholder="Se llenarÃ¡ automÃ¡ticamente" readonly style="background: #f8fafc;" />
              </div>

              <div id="refill-product-info" style="display:none;margin:20px 0;padding:15px;background:var(--primary-light);border-radius:8px;border-left:4px solid var(--primary);">
                <p id="refill-product-name"></p>
                <p id="refill-current-stock" style="color:var(--muted);"></p>
              </div>

              <div class="form-group">
                <label for="refill-boxes">Cantidad de Cajas a Mover</label>
                <input id="refill-boxes" type="number" placeholder="Ej: 5" min="0" />
              </div>

              <button type="submit" class="primary" style="width:100%;">âœ… Registrar Movimiento</button>
            </form>

            <div style="margin-top:30px;">
              <h3>ğŸ“Š Movimientos Hoy</h3>
              <p style="font-size:24px;font-weight:700;color:var(--success);">
                <span id="total-movements">0</span> cajas
              </p>
            </div>
          </div>
        </div>

        <!-- TAB: AUDITORÃA -->
        <div id="tab-audit" class="tab-content hidden">
          <div class="card">
            <h2>âœ“ AuditorÃ­a</h2>
            <form id="audit-form" style="margin-top:20px;">
              <div class="form-group">
                <label for="audit-warehouse">Bodega a Auditar</label>
                <div style="display:flex;gap:8px;">
                  <input id="audit-warehouse" type="text" placeholder="Ej: AlmacÃ©n 1" />
                  <button type="button" id="save-warehouse-btn" class="success" style="width:auto;padding:12px 16px;">âœ“</button>
                </div>
              </div>

              <div id="current-warehouse-display" style="padding:12px;background:var(--bg);border-radius:8px;color:var(--muted);text-align:center;margin-bottom:20px;">
                Ninguna bodega seleccionada
              </div>

              <div class="form-group">
                <label for="audit-barcode">CÃ³digo de Barras</label>
                <div style="display:flex;gap:8px;">
                  <input id="audit-barcode" type="text" placeholder="Escanea el producto" />
                  <button type="button" id="btn-scan-audit" class="success" style="width:auto;padding:12px 16px;">ğŸ“·</button>
                </div>
              </div>

              <div id="audit-stock-info" style="display:none;"></div>

              <div class="form-group">
                <label for="audit-nombre">Nombre del Producto</label>
                <input id="audit-nombre" type="text" placeholder="Se llenarÃ¡ automÃ¡ticamente" readonly style="background: #f8fafc;" />
              </div>

              <div class="form-group">
                <label for="audit-marca">Marca</label>
                <input id="audit-marca" type="text" placeholder="Se llenarÃ¡ automÃ¡ticamente" readonly style="background: #f8fafc;" />
              </div>

              <div class="form-group">
                <label for="audit-piezas">Piezas por Caja</label>
                <input id="audit-piezas" type="number" placeholder="Se llenarÃ¡ automÃ¡ticamente" readonly style="background: #f8fafc;" />
              </div>

              <div id="audit-product-info" style="display:none;margin:20px 0;padding:15px;background:var(--primary-light);border-radius:8px;border-left:4px solid var(--primary);">
                <p id="audit-product-name"></p>
                <p id="audit-product-brand" style="color:var(--muted);"></p>
              </div>

              <div class="form-group">
                <label for="audit-boxes">Cantidad Contada (Cajas)</label>
                <input id="audit-boxes" type="number" placeholder="Cantidad fÃ­sica" min="0" />
              </div>

              <button type="submit" class="primary" style="width:100%;">âœ… Registrar Conteo</button>
            </form>

            <button id="finish-audit-btn" class="warning" style="width:100%;margin-top:15px;display:none;">
              ğŸ Terminar AuditorÃ­a
            </button>

            <div style="margin-top:30px;display:grid;grid-template-columns:1fr 1fr;gap:12px;">
              <div style="padding:15px;background:var(--bg);border-radius:8px;text-align:center;">
                <div style="font-size:24px;font-weight:700;color:var(--primary);" id="audit-total-count">0</div>
                <div style="color:var(--muted);font-size:12px;">cajas auditadas</div>
              </div>
              <div style="padding:15px;background:var(--bg);border-radius:8px;text-align:center;">
                <div style="font-size:24px;font-weight:700;color:var(--success);" id="audit-products-count">0</div>
                <div style="color:var(--muted);font-size:12px;">productos</div>
              </div>
            </div>

            <div id="audit-history" style="margin-top:20px;">
              <p style="color:var(--muted);">Historial vacÃ­o</p>
            </div>
          </div>
        </div>

        <!-- TAB: ANALYTICS -->
        <div id="tab-analytics" class="tab-content hidden">
          <div class="card">
            <h2>ğŸ“Š Analytics - Movimientos</h2>
            <p style="color: #6b7280; font-size: 13px;">Visualiza el rendimiento de tu inventario</p>
            
            <!-- GRÃFICO SEMANAL -->
            <div style="margin-top: 30px;">
              <h3>ğŸ“ˆ Movimientos Esta Semana</h3>
              <div id="weekly-chart-container" style="margin-top: 15px;">
                <p style="color: var(--muted);">Cargando grÃ¡fico...</p>
              </div>
              <div id="weekly-total" style="margin-top: 10px; padding: 12px; background: #f0f9ff; border-radius: 8px; color: #004aad; font-weight: 600;"></div>
            </div>
            
            <!-- GRÃFICO MENSUAL -->
            <div style="margin-top: 40px;">
              <h3>ğŸ“Š Tendencia Mensual</h3>
              <div id="monthly-chart-container" style="margin-top: 15px;">
                <p style="color: var(--muted);">Cargando grÃ¡fico...</p>
              </div>
              <div id="monthly-stats" style="margin-top: 15px;"></div>
            </div>
            
            <!-- TOP PRODUCTOS -->
            <div style="margin-top: 40px;">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                  <h3>ğŸ¥‡ Top Productos (Semanal)</h3>
                  <div id="top-products-weekly" style="margin-top: 15px;">
                    <p style="color: var(--muted);">Cargando...</p>
                  </div>
                </div>
                
                <div>
                  <h3>ğŸ¥‡ Top Productos (Mensual)</h3>
                  <div id="top-products-monthly" style="margin-top: 15px;">
                    <p style="color: var(--muted);">Cargando...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- TAB: SISTEMA / PERFIL -->
        <div id="tab-system" class="tab-content hidden">
          <div id="profile-container">
            <div style="text-align: center; padding: 40px; color: var(--muted);">
              <div style="font-size: 48px; margin-bottom: 16px;">â³</div>
              <p>Cargando perfil...</p>
            </div>
          </div>
        </div>

      </div>

    </section>

  </main>

  <!-- ============================================================
       FOOTER
       ============================================================ -->
  <footer style="background:var(--card-bg);text-align:center;border-top:2px solid var(--border);margin-top:40px;">
    <p style="margin:5px 0;font-weight:600;">Ãguila Inventario Pro v7.6</p>
    <p style="margin:5px 0;color:var(--muted);font-size:18px;">&copy; 2025 JosÃ© A. G. Betancourt - Todos los derechos reservados</p>
  </footer>

  <!-- ============================================================
       FIREBASE SCRIPTS
       ============================================================ -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <!-- ============================================================
       CHART.JS PARA GRÃFICOS
       ============================================================ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

  <!-- ============================================================
       CONFIGURACIÃ“N Y UI BASE
       ============================================================ -->
  <script src="firebase-config.js"></script>
  <script src="ui.js"></script>

  <!-- ============================================================
       ESCÃNER
       ============================================================ -->
  <script src="scanner-mlkit.js"></script>
  <script src="scanner-events.js"></script>

  <!-- ============================================================
       INVENTARIO (FASE 2.1)
       ============================================================ -->
  <script src="inventory.js"></script>
  <script src="inventory-ui.js"></script>

  <!-- ============================================================
       OPERACIONES (FASE 1 - ESTABLES)
       ============================================================ -->
  <script src="refill-enhanced.js"></script>
  <script src="audit.js"></script>

  <!-- ============================================================
       ANALÃTICA (OPCIONAL)
       ============================================================ -->
  <script src="analytics.js"></script>

  <!-- ============================================================
       SISTEMA Y PERFIL (FASE 2.2)
       ============================================================ -->
  <script src="system.js"></script>
  <script src="system-events.js"></script>
  <script src="profile.js"></script>
  <script src="profile-ui.js"></script>

  <!-- ============================================================
       AUTENTICACIÃ“N Y APP
       ============================================================ -->
  <script src="auth.js"></script>
  <script src="app.js"></script>

  <!-- ============================================================
       SERVICE WORKER
       ============================================================ -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(reg => console.log('âœ… Service Worker registrado'))
          .catch(err => console.error('âš ï¸ SW no disponible:', err));
      });
    }
  </script>

  <!-- ============================================================
       SISTEMA DE NAVEGACIÃ“N MOBILE
       ============================================================ -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸ¯ Sistema de navegaciÃ³n iniciando...');

      const navButtons = document.querySelectorAll('.nav-btn');
      const tabContents = document.querySelectorAll('.tab-content');

      navButtons.forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          const tabName = this.getAttribute('data-tab');
          console.log('ğŸ“‘ Navegando a:', tabName);

          navButtons.forEach(b => b.classList.remove('active'));
          tabContents.forEach(t => t.classList.remove('active'));
          tabContents.forEach(t => t.classList.add('hidden'));

          this.classList.add('active');
          const tab = document.getElementById('tab-' + tabName);
          if (tab) {
            tab.classList.remove('hidden');
            tab.classList.add('active');
          }
        });
      });

      console.log('âœ… NavegaciÃ³n lista');
    });
  </script>
</body>
</html>