<!DOCTYPE html>
<html lang="es-MX" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Sistema de inventario profesional para promotores de PepsiCo con modo offline">
  <meta name="author" content="JosÃ© A. G. Betancourt">
  <meta name="theme-color" content="#004aad">
  <title>ğŸ¦… Ãguila Inventario Pro v7.1 (Offline Ready)</title>

  <link rel="manifest" href="manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Ãguila Pro">
  <link rel="apple-touch-icon" href="icon-192x192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512x512.png">

  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="toast-container" role="alert" aria-live="polite" aria-atomic="true"></div>

  <div id="scanner-modal" class="scanner-modal hidden">
    <div class="scanner-container">
      <div style="position:absolute;top:0;width:100%;text-align:center;padding:15px;">
        <h3 style="color:white;margin:0;font-size:1.2em;">EscÃ¡ner de CÃ³digo de Barras</h3>
      </div>
      <div class="scanner-video-wrapper">
        <video id="scanner-video" autoplay playsinline></video>
        <div class="scanner-overlay">
          <div class="scanner-frame"></div>
          <div class="scanner-instruction">Apunta la cÃ¡mara al cÃ³digo de barras</div>
        </div>
      </div>
      <button id="close-scanner" class="scanner-close-btn">Cerrar EscÃ¡ner</button>
    </div>
  </div>

  <main id="main-app">
    
    <!-- SECCIÃ“N AUTH -->
    <section id="auth-setup" class="card" style="max-width:500px;margin:50px auto;">
      <h2 style="text-align:center;color:var(--primary);margin-bottom:24px;">ğŸ¦… Acceso Promotor Ãguila Pro</h2>

      <!-- LOGIN FORM -->
      <form id="login-form">
        <div class="form-group">
          <label for="login-email">Email</label>
          <input id="login-email" type="email" placeholder="tu.email@empresa.com" required />
        </div>
        <div class="form-group">
          <label for="login-password">ContraseÃ±a</label>
          <input id="login-password" type="password" placeholder="MÃ­nimo 6 caracteres" required />
        </div>
        <button type="button" id="btn-login" class="success" style="width:100%;">Iniciar SesiÃ³n</button>
        <p style="text-align:center;margin-top:15px;">
          <a href="#" id="show-forgot-password" style="color:var(--warning);">Â¿Olvidaste tu contraseÃ±a?</a>
        </p>
        <p style="text-align:center;">
          <a href="#" id="show-register" style="color:var(--primary);">Â¿Eres nuevo? RegÃ­strate aquÃ­</a>
        </p>
      </form>

      <!-- FORGOT PASSWORD FORM -->
      <form id="forgot-password-form" class="hidden">
        <h3 style="text-align:center;color:var(--primary);">Recuperar ContraseÃ±a</h3>
        <div class="form-group">
          <label for="forgot-email">Email</label>
          <input id="forgot-email" type="email" placeholder="tu.email@empresa.com" required />
        </div>
        <button type="submit" class="warning" style="width:100%;">Enviar Enlace</button>
        <p style="text-align:center;margin-top:15px;">
          <a href="#" id="show-login-from-forgot" style="color:var(--primary);">Volver al inicio de sesiÃ³n</a>
        </p>
      </form>

      <!-- REGISTER FORM -->
      <form id="register-form" class="hidden">
        <h3 style="text-align:center;color:var(--primary);">Registro Inicial</h3>
        <div class="form-group">
          <label for="register-email">Email</label>
          <input id="register-email" type="email" placeholder="tu.email@empresa.com" required />
        </div>
        <div class="form-group">
          <label for="register-password">ContraseÃ±a</label>
          <input id="register-password" type="password" placeholder="MÃ­nimo 6 caracteres" minlength="6" required />
        </div>
        <div class="form-group">
          <label for="register-determinante">Determinante (Tienda)</label>
          <input id="register-determinante" type="number" placeholder="Ej: 12345" required />
        </div>
        <div class="form-group">
          <label for="register-store-name">Nombre de la Tienda</label>
          <input id="register-store-name" type="text" placeholder="Ej: Oxxo Centro" required />
        </div>
        <div class="form-group">
          <label for="register-promoter-name">Nombre del Promotor</label>
          <input id="register-promoter-name" type="text" placeholder="Ej: Juan PÃ©rez" required />
        </div>
        <button type="submit" class="success" style="width:100%;">Registrar y Entrar</button>
        <p style="text-align:center;margin-top:15px;">
          <a href="#" id="show-login" style="color:var(--primary);">Ya tengo cuenta</a>
        </p>
      </form>
    </section>

    <!-- APP CONTAINER -->
    <section id="app-container" style="display:none;">
      
      <!-- HEADER -->
      <div class="app-header">
        <div style="display:flex;align-items:center;gap:12px;">
          <button class="btn-icon" id="btn-menu">â˜°</button>
          <div class="app-title">ğŸ¦… Ãguila Pro</div>
        </div>
        <div style="display:flex;align-items:center;gap:12px;">
          <button class="btn-icon" id="btn-offline-status">ğŸ“¡</button>
          <button class="btn-icon" id="btn-logout">ğŸšª</button>
        </div>
      </div>

      <!-- SIDEBAR -->
      <aside class="sidebar" id="sidebar">
        <nav>
          <a href="#" class="nav-item active" data-tab="inventory">
            <span class="nav-icon">ğŸ“¦</span>
            <span>Inventario</span>
          </a>
          <a href="#" class="nav-item" data-tab="add">
            <span class="nav-icon">â•</span>
            <span>Agregar</span>
          </a>
          <a href="#" class="nav-item" data-tab="refill">
            <span class="nav-icon">ğŸ”„</span>
            <span>Relleno</span>
          </a>
          <a href="#" class="nav-item" data-tab="audit">
            <span class="nav-icon">âœ“</span>
            <span>AuditorÃ­a</span>
          </a>
          <a href="#" class="nav-item" data-tab="reports">
            <span class="nav-icon">ğŸ“Š</span>
            <span>Reportes</span>
          </a>
          <a href="#" class="nav-item" data-tab="settings">
            <span class="nav-icon">âš™ï¸</span>
            <span>ConfiguraciÃ³n</span>
          </a>
        </nav>
      </aside>

      <!-- MAIN CONTENT (CON ESTILOS MOBILE) -->
      <div class="main-content" style="display: block;">
        
        <!-- TAB: Inventario -->
        <div id="tab-inventory" class="tab-content active">
          <div class="card">
            <h2>ğŸ“¦ GestiÃ³n de Inventario</h2>
            <div id="inventory-list" style="margin-top:20px;">
              <p style="color:var(--muted);">Cargando inventario...</p>
            </div>
          </div>
        </div>

        <!-- TAB: Agregar Producto -->
        <div id="tab-add" class="tab-content">
          <div class="card">
            <h2>â• Agregar Producto</h2>
            
            <form id="add-product-form" style="margin-top:20px;">
              
              <div class="form-group">
                <label for="add-barcode">CÃ³digo de Barras</label>
                <div style="display:flex;gap:8px;">
                  <input id="add-barcode" type="text" placeholder="Escanea o ingresa el cÃ³digo" />
                  <button type="button" id="btn-scan-add" class="success" style="width:auto;padding:12px 16px;">ğŸ“·</button>
                </div>
              </div>

              <div class="form-group">
                <label for="add-product-name">Nombre del Producto</label>
                <input id="add-product-name" type="text" placeholder="Ej: Pepsi 1L" required />
              </div>

              <div class="form-group">
                <label for="add-brand">Marca</label>
                <select id="add-brand" required>
                  <option value="">-- Selecciona una marca --</option>
                  <option value="Sabritas">Sabritas</option>
                  <option value="Gamesa">Gamesa</option>
                  <option value="Quaker">Quaker</option>
                  <option value="Sonric's">Sonric's</option>
                  <option value="Otra">Otra</option>
                </select>
              </div>

              <div class="form-group">
                <label for="add-pieces-per-box">Piezas por Caja</label>
                <input id="add-pieces-per-box" type="number" placeholder="Ej: 24" min="1" required />
              </div>

              <div class="form-group">
                <label for="add-warehouse">UbicaciÃ³n/AlmacÃ©n</label>
                <input id="add-warehouse" type="text" placeholder="Ej: AlmacÃ©n 1" required />
              </div>

              <div class="form-group">
                <label for="add-expiry-date">Fecha de Caducidad</label>
                <input id="add-expiry-date" type="date" required />
              </div>

              <div class="form-group">
                <label for="add-boxes">Cantidad de Cajas</label>
                <input id="add-boxes" type="number" placeholder="Ej: 10" min="0" required />
              </div>

              <button type="submit" class="primary" style="width:100%;">âœ… Guardar Producto</button>
            </form>
          </div>
        </div>

        <!-- TAB: Relleno -->
        <div id="tab-refill" class="tab-content">
          <div class="card">
            <h2>ğŸ”„ Reabastecimiento</h2>
            
            <form id="refill-form" style="margin-top:20px;">
              <div class="form-group">
                <label for="refill-barcode">CÃ³digo de Barras</label>
                <input id="refill-barcode" type="text" placeholder="Escanea o escribe el cÃ³digo" />
              </div>

              <div id="refill-product-info" style="display:none;margin:20px 0;padding:15px;background:var(--primary-light);border-radius:8px;">
                <p id="refill-product-name"></p>
                <p id="refill-current-stock" style="color:var(--muted);"></p>
              </div>

              <div class="form-group">
                <label for="refill-boxes">Cantidad de Cajas a Mover</label>
                <input id="refill-boxes" type="number" placeholder="Ej: 5" min="0" />
              </div>

              <button type="submit" class="primary" style="width:100%;">âœ… Registrar Movimiento</button>
            </form>

            <div style="margin-top:30px;">
              <h3>ğŸ“Š Movimientos Hoy</h3>
              <p style="font-size:24px;font-weight:700;color:var(--primary);">
                <span id="total-movements">0</span> cajas
              </p>
            </div>
          </div>
        </div>

        <!-- TAB: AuditorÃ­a -->
        <div id="tab-audit" class="tab-content">
          <div class="card">
            <h2>âœ“ AuditorÃ­a</h2>
            
            <form id="audit-form" style="margin-top:20px;">
              <div class="form-group">
                <label for="audit-warehouse">Bodega a Auditar</label>
                <div style="display:flex;gap:8px;">
                  <input id="audit-warehouse" type="text" placeholder="Ej: AlmacÃ©n 1" />
                  <button type="button" id="save-warehouse-btn" class="success" style="width:auto;padding:12px 16px;">âœ“</button>
                </div>
              </div>

              <div id="current-warehouse-display" style="padding:12px;background:var(--bg);border-radius:8px;color:var(--muted);text-align:center;margin-bottom:20px;">
                Ninguna bodega seleccionada
              </div>

              <div class="form-group">
                <label for="audit-barcode">CÃ³digo de Barras</label>
                <input id="audit-barcode" type="text" placeholder="Escanea el producto" />
              </div>

              <div id="audit-product-info" style="display:none;margin:20px 0;padding:15px;background:var(--primary-light);border-radius:8px;">
                <p id="audit-product-name"></p>
                <p id="audit-product-brand" style="color:var(--muted);"></p>
              </div>

              <div class="form-group">
                <label for="audit-boxes">Cantidad Contada (Cajas)</label>
                <input id="audit-boxes" type="number" placeholder="Cantidad fÃ­sica" min="0" />
              </div>

              <button type="submit" class="primary" style="width:100%;">âœ… Registrar Conteo</button>
            </form>

            <button id="finish-audit-btn" class="warning" style="width:100%;margin-top:15px;display:none;">
              ğŸ Terminar AuditorÃ­a
            </button>

            <div style="margin-top:30px;">
              <h3>ğŸ“‹ Resumen de Hoy</h3>
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                <div style="padding:15px;background:var(--bg);border-radius:8px;text-align:center;">
                  <div style="font-size:28px;font-weight:700;color:var(--primary);" id="audit-total-count">0</div>
                  <div style="color:var(--muted);font-size:12px;">cajas auditadas</div>
                </div>
                <div style="padding:15px;background:var(--bg);border-radius:8px;text-align:center;">
                  <div style="font-size:28px;font-weight:700;color:var(--success);" id="audit-products-count">0</div>
                  <div style="color:var(--muted);font-size:12px;">productos</div>
                </div>
              </div>
            </div>

            <div id="audit-history" style="margin-top:20px;">
              <p style="color:var(--muted);">Historial de movimientos vacÃ­o</p>
            </div>
          </div>
        </div>

        <!-- TAB: Reportes -->
        <div id="tab-reports" class="tab-content">
          <div class="card">
            <h2>ğŸ“Š Reportes</h2>
            <div style="margin:20px 0;display:flex;gap:10px;flex-wrap:wrap;">
              <button class="primary">ğŸ“¥ Exportar Inventario</button>
              <button class="warning">ğŸ“‹ Resumen Diario</button>
              <button class="primary">ğŸ“Š EstadÃ­sticas</button>
            </div>
          </div>
        </div>

        <!-- TAB: ConfiguraciÃ³n -->
        <div id="tab-settings" class="tab-content">
          <div class="card">
            <h2>âš™ï¸ ConfiguraciÃ³n</h2>
            <div style="margin:20px 0;">
              <p id="user-info" style="font-weight:600;margin:10px 0;">Usuario</p>
              <button class="warning" id="btn-change-password">ğŸ” Cambiar ContraseÃ±a</button>
              <button class="primary" id="btn-diagnostico">ğŸ” DiagnÃ³stico</button>
              <button class="warning" id="btn-stats">ğŸ“Š EstadÃ­sticas</button>
              <button class="error" id="btn-logout-settings">ğŸšª Cerrar SesiÃ³n</button>
            </div>
          </div>
        </div>

      </div>

    </section>

  </main>

  <footer style="background:var(--card-bg);padding:20px;text-align:center;border-top:2px solid var(--border);margin-top:40px;">
    <p style="margin:5px 0;font-weight:600;">Ãguila Inventario Pro v7.1</p>
    <p style="margin:5px 0;color:var(--muted);font-size:14px;">&copy; 2025 JosÃ© A. G. Betancourt</p>
    <p style="margin:5px 0;color:var(--muted);font-size:12px;">Sistema de GestiÃ³n de Inventario</p>
  </footer>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <!-- Application Scripts (en orden) -->
  <script src="firebase-config.js"></script>
  <script src="ui.js"></script>
  <script src="scanner.js"></script>
  <script src="inventory.js"></script>
  <script src="refill.js"></script>
  <script src="audit.js"></script>
  <script src="system.js"></script>
  <script src="auth.js"></script>
  <script src="app.js"></script>

  <!-- SCRIPT PARA FIJAR NAVEGACIÃ“N EN MOBILE -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸ¯ Configurando navegaciÃ³n...');
      
      // Obtener todos los nav-items
      const navItems = document.querySelectorAll('[data-tab]');
      const tabContents = document.querySelectorAll('.tab-content');
      const sidebar = document.getElementById('sidebar');
      
      navItems.forEach(item => {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          
          const tabName = this.getAttribute('data-tab');
          console.log('ğŸ“‘ Activando tab:', tabName);
          
          // Remover clase active de todas las pestaÃ±as y nav items
          tabContents.forEach(tab => tab.classList.remove('active'));
          navItems.forEach(nav => nav.classList.remove('active'));
          
          // Agregar clase active al elemento clickeado
          this.classList.add('active');
          const activeTab = document.getElementById('tab-' + tabName);
          if (activeTab) {
            activeTab.classList.add('active');
            console.log('âœ… PestaÃ±a ' + tabName + ' activada');
          }
          
          // Cerrar sidebar en mobile
          if (sidebar && sidebar.classList.contains('active')) {
            sidebar.classList.remove('active');
            console.log('ğŸ”’ Sidebar cerrado');
          }
        });
      });
      
      // BotÃ³n menÃº (abrir/cerrar sidebar)
      const btnMenu = document.getElementById('btn-menu');
      if (btnMenu) {
        btnMenu.addEventListener('click', (e) => {
          e.preventDefault();
          if (sidebar) {
            sidebar.classList.toggle('active');
            console.log('ğŸ”„ Sidebar toggled');
          }
        });
      }
      
      console.log('âœ… NavegaciÃ³n configurada correctamente');
    });
  </script>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(reg => console.log('âœ… Service Worker registrado'))
          .catch(err => console.error('âŒ Error SW:', err));
      });
    }
  </script>
</body>
</html>